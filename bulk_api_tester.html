<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groq API Key Bulk Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f9fafb;
        }
        
        h1, h2 {
            color: #2563eb;
            text-align: center;
        }
        
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #1e293b;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 16px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 14px;
            background-color: #f8fafc;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }
        
        button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
            display: block;
            width: 100%;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        button:disabled {
            background-color: #94a3b8;
            cursor: not-allowed;
        }
        
        .results-container {
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .results-header {
            display: grid;
            grid-template-columns: 1fr 150px 150px 80px;
            background-color: #f1f5f9;
            padding: 10px;
            font-weight: bold;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .results-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .result-item {
            display: grid;
            grid-template-columns: 1fr 150px 150px 80px;
            padding: 12px 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .result-item:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .success {
            color: #16a34a;
        }
        
        .error {
            color: #dc2626;
        }
        
        .pending {
            color: #6b7280;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            vertical-align: middle;
        }
        
        .status-indicator.success {
            background-color: #22c55e;
        }
        
        .status-indicator.error {
            background-color: #ef4444;
        }
        
        .status-indicator.pending {
            background-color: #9ca3af;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .controls button {
            margin-bottom: 0;
        }
        
        .summary {
            background-color: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .summary-item {
            font-size: 20px;
            font-weight: bold;
        }
        
        .summary-label {
            font-size: 14px;
            color: #64748b;
        }
        
        .copy-button {
            background-color: #10b981;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .copy-button:hover {
            background-color: #059669;
        }
        
        .copy-success {
            color: #16a34a;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .error-details {
            margin-top: 5px;
            font-size: 12px;
            color: #6b7280;
        }
        
        #working-keys-output {
            margin-top: 20px;
            background-color: #f8fafc;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Groq API Key Bulk Tester</h1>
    
    <div class="container">
        <div class="summary">
            <div>
                <div id="total-count" class="summary-item">0</div>
                <div class="summary-label">Total Keys</div>
            </div>
            <div>
                <div id="working-count" class="summary-item success">0</div>
                <div class="summary-label">Working</div>
            </div>
            <div>
                <div id="broken-count" class="summary-item error">0</div>
                <div class="summary-label">Broken</div>
            </div>
            <div>
                <div id="pending-count" class="summary-item pending">0</div>
                <div class="summary-label">Pending</div>
            </div>
        </div>
        
        <div class="main-grid">
            <div>
                <label for="api-keys">Paste All Groq API Keys (One per line):</label>
                <textarea id="api-keys" placeholder="gsk_xxxxxxxx&#10;gsk_yyyyyyyy&#10;gsk_zzzzzzzz"></textarea>
            </div>
            <div>
                <label for="prompt">Test Prompt:</label>
                <textarea id="prompt">Respond with a simple "Hello" message only.</textarea>
                
                <div class="controls">
                    <button id="test-all-button">Test All Keys</button>
                    <button id="clear-button">Clear Results</button>
                </div>
                
                <button id="export-working-keys" style="background-color: #10b981;">Export Working Keys</button>
                <div id="working-keys-output"></div>
                <div id="copy-success" class="copy-success">Working keys copied to clipboard!</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>Test Results</h2>
        
        <div class="results-container">
            <div class="results-header">
                <div>API Key</div>
                <div>Status</div>
                <div>Response Time</div>
                <div>Actions</div>
            </div>
            <div class="results-list" id="results-list"></div>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const apiKeysTextarea = document.getElementById('api-keys');
        const promptTextarea = document.getElementById('prompt');
        const testAllButton = document.getElementById('test-all-button');
        const clearButton = document.getElementById('clear-button');
        const resultsList = document.getElementById('results-list');
        const totalCount = document.getElementById('total-count');
        const workingCount = document.getElementById('working-count');
        const brokenCount = document.getElementById('broken-count');
        const pendingCount = document.getElementById('pending-count');
        const exportButton = document.getElementById('export-working-keys');
        const workingKeysOutput = document.getElementById('working-keys-output');
        const copySuccess = document.getElementById('copy-success');
        
        // State
        let results = [];
        let testQueue = [];
        let isProcessing = false;
        let concurrentRequests = 3; // Number of concurrent API requests
        
        // Initialize with sample keys (optional - for demonstration)
        apiKeysTextarea.value = '';
        
        // Event Listeners
        testAllButton.addEventListener('click', startTesting);
        clearButton.addEventListener('click', clearResults);
        exportButton.addEventListener('click', exportWorkingKeys);
        
        // Main test function
        function startTesting() {
            // Clear previous results
            results = [];
            
            // Get keys and prompt
            const keys = apiKeysTextarea.value.trim().split('\n')
                .map(key => key.trim())
                .filter(key => key && key.startsWith('gsk_'));
            
            if (keys.length === 0) {
                alert('Please enter at least one API key');
                return;
            }
            
            const prompt = promptTextarea.value.trim() || 'Hello';
            
            // Disable buttons
            testAllButton.disabled = true;
            testAllButton.textContent = 'Testing...';
            
            // Update counts
            totalCount.textContent = keys.length;
            workingCount.textContent = '0';
            brokenCount.textContent = '0';
            pendingCount.textContent = keys.length;
            
            // Prepare test queue
            testQueue = keys.map(key => ({ key }));
            
            // Clear results UI
            resultsList.innerHTML = '';
            
            // Add all keys to results list as pending
            testQueue.forEach((item, index) => {
                const resultItem = createResultItem(item.key, index);
                resultsList.appendChild(resultItem);
            });
            
            // Start processing
            isProcessing = true;
            for (let i = 0; i < Math.min(concurrentRequests, testQueue.length); i++) {
                processNextKey();
            }
        }
        
        async function processNextKey() {
            if (testQueue.length === 0 || !isProcessing) {
                // If queue is empty or processing stopped, check if we're done
                if (getPendingCount() === 0) {
                    testAllButton.disabled = false;
                    testAllButton.textContent = 'Test All Keys';
                    isProcessing = false;
                }
                return;
            }
            
            // Get next key
            const item = testQueue.shift();
            const prompt = promptTextarea.value.trim() || 'Hello';
            
            try {
                // Update UI to show we're testing this key
                updateResultItem(item.key, 'Testing...', 'pending');
                
                // Start timer
                const startTime = Date.now();
                
                // Test the key
                const result = await testGroqApiKey(item.key, prompt);
                
                // Calculate time
                const endTime = Date.now();
                const responseTime = (endTime - startTime) / 1000; // in seconds
                
                // Update UI
                if (result.success) {
                    updateResultItem(
                        item.key, 
                        'Working', 
                        'success',
                        responseTime, 
                        result.data
                    );
                    workingCount.textContent = (parseInt(workingCount.textContent) + 1).toString();
                } else {
                    updateResultItem(
                        item.key, 
                        `Failed: ${result.error}`, 
                        'error',
                        responseTime, 
                        result.data
                    );
                    brokenCount.textContent = (parseInt(brokenCount.textContent) + 1).toString();
                }
                
                // Update pending count
                pendingCount.textContent = (parseInt(pendingCount.textContent) - 1).toString();
                
                // Store result
                results.push({
                    key: item.key,
                    success: result.success,
                    error: result.error,
                    data: result.data,
                    responseTime
                });
                
            } catch (error) {
                // Handle unexpected errors
                updateResultItem(item.key, `Error: ${error.message}`, 'error');
                brokenCount.textContent = (parseInt(brokenCount.textContent) + 1).toString();
                pendingCount.textContent = (parseInt(pendingCount.textContent) - 1).toString();
                
                results.push({
                    key: item.key,
                    success: false,
                    error: error.message
                });
            }
            
            // Process next key in queue
            processNextKey();
        }
        
        async function testGroqApiKey(apiKey, prompt) {
            const url = 'https://api.groq.com/openai/v1/chat/completions';
            const headers = {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            };
            const data = {
                model: 'llama3-8b-8192',
                messages: [{ role: 'user', content: prompt }]
            };
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(data)
                });
                
                const responseData = await response.json();
                
                if (response.ok) {
                    return {
                        success: true,
                        data: responseData
                    };
                } else {
                    return {
                        success: false,
                        error: responseData.error?.message || 'Unknown error',
                        data: responseData
                    };
                }
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function createResultItem(key, index) {
            const item = document.createElement('div');
            item.className = 'result-item';
            item.id = `result-${btoa(key)}`;
            
            const keyShort = key.substring(0, 12) + '***';
            
            item.innerHTML = `
                <div class="key-text">${keyShort}</div>
                <div class="status pending">
                    <span class="status-indicator pending"></span>
                    Pending
                </div>
                <div class="response-time">-</div>
                <div class="actions">
                    <button class="view-details" data-index="${index}" style="display:none;">Details</button>
                </div>
            `;
            
            return item;
        }
        
        function updateResultItem(key, statusText, statusClass, responseTime, data) {
            const itemId = `result-${btoa(key)}`;
            const item = document.getElementById(itemId);
            
            if (!item) return;
            
            const statusElement = item.querySelector('.status');
            const responseTimeElement = item.querySelector('.response-time');
            const viewDetailsButton = item.querySelector('.view-details');
            
            // Update status
            statusElement.className = `status ${statusClass}`;
            statusElement.innerHTML = `
                <span class="status-indicator ${statusClass}"></span>
                ${statusText}
            `;
            
            // Add error details if needed
            if (statusClass === 'error' && data?.error) {
                const errorCode = data.error.code || 'unknown';
                statusElement.innerHTML += `
                    <div class="error-details">Code: ${errorCode}</div>
                `;
            }
            
            // Update response time
            if (responseTime !== undefined) {
                responseTimeElement.textContent = `${responseTime.toFixed(2)}s`;
            }
            
            // Show details button if there's data
            if (data) {
                viewDetailsButton.style.display = 'block';
                viewDetailsButton.addEventListener('click', () => {
                    showDetails(key, data, statusClass);
                });
            }
        }
        
        function showDetails(key, data, statusClass) {
            // Create a modal to show details
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '1000';
            
            const content = document.createElement('div');
            content.style.backgroundColor = 'white';
            content.style.padding = '20px';
            content.style.borderRadius = '8px';
            content.style.maxWidth = '800px';
            content.style.width = '90%';
            content.style.maxHeight = '80vh';
            content.style.overflow = 'auto';
            
            const title = document.createElement('h3');
            title.textContent = `Details for ${key.substring(0, 10)}***`;
            
            const closeButton = document.createElement('button');
            closeButton.textContent = 'Close';
            closeButton.style.marginTop = '20px';
            closeButton.addEventListener('click', () => document.body.removeChild(modal));
            
            const pre = document.createElement('pre');
            pre.style.backgroundColor = '#f8fafc';
            pre.style.padding = '10px';
            pre.style.overflow = 'auto';
            pre.style.fontSize = '14px';
            pre.style.borderRadius = '4px';
            pre.style.border = statusClass === 'success' ? '1px solid #10b981' : '1px solid #ef4444';
            pre.textContent = JSON.stringify(data, null, 2);
            
            content.appendChild(title);
            content.appendChild(pre);
            content.appendChild(closeButton);
            modal.appendChild(content);
            
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        function clearResults() {
            // Stop current processing
            isProcessing = false;
            testQueue = [];
            
            // Clear UI
            resultsList.innerHTML = '';
            totalCount.textContent = '0';
            workingCount.textContent = '0';
            brokenCount.textContent = '0';
            pendingCount.textContent = '0';
            
            // Clear results array
            results = [];
            
            // Reset buttons
            testAllButton.disabled = false;
            testAllButton.textContent = 'Test All Keys';
            
            // Hide working keys output
            workingKeysOutput.style.display = 'none';
            copySuccess.style.display = 'none';
        }
        
        function getPendingCount() {
            return parseInt(pendingCount.textContent);
        }
        
        function exportWorkingKeys() {
            const workingKeys = results.filter(r => r.success).map(r => r.key);
            
            if (workingKeys.length === 0) {
                workingKeysOutput.textContent = 'No working keys found.';
            } else {
                workingKeysOutput.textContent = workingKeys.join('\n');
            }
            
            workingKeysOutput.style.display = 'block';
            
            // Copy to clipboard
            navigator.clipboard.writeText(workingKeysOutput.textContent)
                .then(() => {
                    copySuccess.style.display = 'block';
                    setTimeout(() => {
                        copySuccess.style.display = 'none';
                    }, 3000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        }
    </script>
</body>
</html>